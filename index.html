<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZenBudget</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/ios-filled/512/00f2ff/b-filled.png">

    <style>
        :root { --bg: #050505; --card: #121217; --cyan: #00f2ff; --purple: #7000ff; --green: #00ff88; --red: #ff4d4d; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: env(safe-area-inset-top) 20px 140px 20px; -webkit-tap-highlight-color: transparent; }
        
        /* Nav */
        .nav { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 90%; height: 60px; background: #1a1a1e; display: flex; border-radius: 30px; z-index: 9999; border: 1px solid #333; overflow: hidden; }
        .nav button { flex: 1; border: none; background: none; color: #888; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .nav button.active { color: var(--cyan); }

        /* Screens */
        .screen { display: none; }
        .screen.active { display: block; }

        /* Jauges */
        .gauge-container { position: relative; width: 200px; height: 200px; margin: 20px auto; }
        svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .ring-bg { fill: none; stroke: #1a1a1a; stroke-width: 12; }
        .ring-fill { fill: none; stroke-width: 12; stroke-linecap: round; transition: 0.5s; }
        .gauge-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; }

        /* Inputs & Buttons - CRUCIAL POUR IPHONE */
        .card { background: var(--card); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid #222; }
        input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; background: #1e1e24; color: #fff; border: 1px solid #444; font-size: 16px; box-sizing: border-box; }
        
        /* Utilisation de vrais boutons pour forcer le focus iOS */
        .btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 16px; font-weight: bold; margin: 5px 0; display: block; cursor: pointer; }
        .btn:active { opacity: 0.5; }
        .btn-purple { background: var(--purple); color: #fff; }
        .btn-green { background: var(--green); color: #000; }
        .btn-red { background: var(--red); color: #000; }

        .item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #222; }
    </style>

    <script>
        // LE SCRIPT EST PLACÉ ICI POUR ÊTRE PRIORITAIRE
        let db = JSON.parse(localStorage.getItem('zenbudget_db')) || { base: 1047.92, limit: 0, tx: [] };

        function update() {
            localStorage.setItem('zenbudget_db', JSON.stringify(db));
            render();
        }

        function add(type) {
            let n = document.getElementById('name').value;
            let a = parseFloat(document.getElementById('amount').value);
            if(!n || isNaN(a)) return;
            db.tx.push({ n, a: type === 'loss' ? -a : a, d: new Date().toDateString() });
            document.getElementById('name').value = '';
            document.getElementById('amount').value = '';
            update();
        }

        function setLimit() {
            let v = parseFloat(document.getElementById('limit-in').value);
            if(isNaN(v)) return;
            db.limit = v;
            update();
        }

        function render() {
            const totalOut = db.tx.filter(t => t.a < 0).reduce((s, t) => s + Math.abs(t.a), 0);
            const totalIn = db.tx.filter(t => t.a > 0).reduce((s, t) => s + t.a, 0);
            const bal = db.base + totalIn - totalOut;
            
            // UI Global
            if(document.getElementById('bal-txt')) {
                document.getElementById('bal-txt').innerText = bal.toFixed(2) + '€';
                let circ = 2 * Math.PI * 85;
                let pct = Math.min(100, (bal/2000)*100);
                document.getElementById('ring-g').style.strokeDasharray = circ;
                document.getElementById('ring-g').style.strokeDashoffset = circ - (pct/100)*circ;
            }

            // UI Budget
            if(document.getElementById('budget-txt')) {
                let spent = db.tx.filter(t => t.a < 0).reduce((s, t) => s + Math.abs(t.a), 0); // Simplifié pour test
                let left = db.limit - spent;
                document.getElementById('budget-txt').innerText = left.toFixed(2) + '€';
            }
            
            // Listes
            let html = db.tx.slice(-3).reverse().map(t => `<div class="item"><span>${t.n}</span><b>${t.a}€</b></div>`).join('');
            document.getElementById('list-g').innerHTML = html;
        }

        function show(id, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        window.onload = render;
    </script>
</head>
<body>

    <div id="scr1" class="screen active">
        <h2 style="text-align:center">Global</h2>
        <div class="gauge-container">
            <svg viewBox="0 0 200 200"><circle class="ring-bg" cx="100" cy="100" r="85"></circle><circle id="ring-g" class="ring-fill" cx="100" cy="100" r="85" stroke="var(--cyan)"></circle></svg>
            <div class="gauge-text"><small>SOLDE</small><br><b id="bal-txt" style="font-size:24px">0€</b></div>
        </div>
        <div class="card" id="list-g"></div>
    </div>

    <div id="scr2" class="screen">
        <h2 style="text-align:center">Budget</h2>
        <div class="card">
            <input type="number" id="limit-in" placeholder="Limite">
            <button class="btn btn-purple" onclick="setLimit()">VALIDER LIMITE</button>
            <div class="gauge-container" style="width:140px; height:140px;">
                <svg viewBox="0 0 200 200"><circle class="ring-bg" cx="100" cy="100" r="85"></circle><circle class="ring-fill" cx="100" cy="100" r="85" stroke="var(--purple)" style="stroke-dasharray: 534; stroke-dashoffset: 200;"></circle></svg>
                <div class="gauge-text"><small>RESTANT</small><br><b id="budget-txt">0€</b></div>
            </div>
        </div>
        <div class="card">
            <input type="text" id="name" placeholder="Nom">
            <input type="number" id="amount" placeholder="Montant">
            <button class="btn btn-green" onclick="add('gain')">+ ENTRÉE</button>
            <button class="btn btn-red" onclick="add('loss')">- DÉPENSE</button>
        </div>
    </div>

    <div id="scr3" class="screen">
        <h2 style="text-align:center">Calendrier</h2>
        <div class="card" style="text-align:center">Fonction de défilement active.</div>
    </div>

    <nav class="nav">
        <button class="active" onclick="show('scr1', this)">Global</button>
        <button onclick="show('scr2', this)">Budget</button>
        <button onclick="show('scr3', this)">Calendrier</button>
    </nav>

</body>
</html>
