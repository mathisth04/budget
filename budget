<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Budget 2026</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: white; margin: 0; font-family: sans-serif; }
        .card { background-color: #0F0F0F; border: 1px solid #1A1A1A; border-radius: 12px; }
    </style>
</head>
<body>
    <div id="root">
        <div style="color: gray; text-align: center; margin-top: 50px;">Chargement de l'application...</div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const COLORS = { blue: '#00D4FF', purple: '#BB86FC', green: '#00FF9D', red: '#FF3D71', border: '#1A1A1A' };

        function App() {
            const [currentTab, setCurrentTab] = useState('Global');
            const [transactions, setTransactions] = useState([]);
            const [budgetLimit, setBudgetLimit] = useState(0);
            const [isLimitLocked, setIsLimitLocked] = useState(false);
            const [desc, setDesc] = useState('');
            const [amount, setAmount] = useState('');
            const [tempLimit, setTempLimit] = useState('');

            // Chargement initial
            useEffect(() => {
                try {
                    const savedTx = localStorage.getItem('@tx_final');
                    if (savedTx) setTransactions(JSON.parse(savedTx));
                    const savedLimit = localStorage.getItem('@limit_final');
                    if (savedLimit) setBudgetLimit(parseFloat(savedLimit));
                    const savedLocked = localStorage.getItem('@locked_final');
                    if (savedLocked === 'true') setIsLimitLocked(true);
                } catch (e) { console.error("Erreur de chargement", e); }
            }, []);

            // Sauvegarde auto
            useEffect(() => {
                localStorage.setItem('@tx_final', JSON.stringify(transactions));
                localStorage.setItem('@limit_final', budgetLimit.toString());
                localStorage.setItem('@locked_final', isLimitLocked.toString());
            }, [transactions, budgetLimit, isLimitLocked]);

            const totalIn = transactions.filter(t => t.amount > 0).reduce((s, t) => s + t.amount, 0);
            const totalOut = transactions.filter(t => t.amount < 0).reduce((s, t) => s + Math.abs(t.amount), 0);
            const balance = 1047.92 + totalIn - totalOut;

            const addTx = (type) => {
                if (!desc || !amount) return;
                const val = type === 'in' ? Math.abs(parseFloat(amount)) : -Math.abs(parseFloat(amount));
                const newT = { 
                    id: Date.now().toString(), 
                    desc, 
                    amount: val, 
                    date: new Date().toLocaleDateString() 
                };
                setTransactions([newT, ...transactions]);
                setDesc(''); setAmount('');
            };

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col p-4">
                    <div className="flex justify-around mb-8 border-b border-gray-800 pb-2">
                        {['Global', 'Budget'].map(t => (
                            <button key={t} onClick={() => setCurrentTab(t)} 
                                className={`text-sm font-bold ${currentTab === t ? 'text-cyan-400' : 'text-gray-500'}`}>
                                {t.toUpperCase()}
                            </button>
                        ))}
                    </div>

                    {currentTab === 'Global' ? (
                        <div className="text-center">
                            <div className="text-gray-500 text-xs mb-1">SOLDE ACTUEL</div>
                            <div className="text-4xl font-bold text-cyan-400 mb-8">{balance.toFixed(2)}€</div>
                            
                            <div className="grid grid-cols-2 gap-4 mb-8">
                                <div className="card p-3"><div className="text-[10px] text-gray-500">ENTRÉES</div><div className="text-green-400">{totalIn.toFixed(2)}€</div></div>
                                <div className="card p-3"><div className="text-[10px] text-gray-500">SORTIES</div><div className="text-red-400">-{totalOut.toFixed(2)}€</div></div>
                            </div>

                            <div className="text-left">
                                <h3 className="text-cyan-400 text-sm font-bold mb-4 uppercase italic">Historique</h3>
                                {transactions.map(t => (
                                    <div key={t.id} className="card p-3 flex justify-between items-center mb-2">
                                        <div className="text-sm">{t.desc}</div>
                                        <div className={`font-bold ${t.amount > 0 ? 'text-green-400' : 'text-red-400'}`}>{t.amount.toFixed(2)}€</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ) : (
                        <div className="flex flex-col gap-4">
                            {!isLimitLocked ? (
                                <div className="card p-4">
                                    <input type="number" placeholder="Limite Mensuelle" className="w-full bg-black border border-gray-800 p-2 rounded mb-4" onChange={(e) => setTempLimit(e.target.value)} />
                                    <button onClick={() => {setBudgetLimit(parseFloat(tempLimit)); setIsLimitLocked(true);}} className="w-full bg-cyan-500 text-black font-bold p-2 rounded">FIXER LA LIMITE</button>
                                </div>
                            ) : (
                                <div className="card p-4">
                                    <div className="text-center mb-4">Limite : {budgetLimit}€</div>
                                    <input type="text" placeholder="Nom" value={desc} onChange={(e) => setDesc(e.target.value)} className="w-full bg-black border border-gray-800 p-2 rounded mb-2" />
                                    <input type="number" placeholder="Montant" value={amount} onChange={(e) => setAmount(e.target.value)} className="w-full bg-black border border-gray-800 p-2 rounded mb-4" />
                                    <div className="flex gap-2">
                                        <button onClick={() => addTx('in')} className="flex-1 bg-green-500 text-black font-bold p-2 rounded">GAIN</button>
                                        <button onClick={() => addTx('out')} className="flex-1 bg-red-500 text-black font-bold p-2 rounded">DÉPENSE</button>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
